<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Cognitive Graph Agent</title>
  <meta name="app-data" content='{"node_types":{{ node_types|tojson }},"node_states":{{ node_states|tojson }},"relation_types":{{ relation_types|tojson }}}'/>
  <link rel="stylesheet" href="/static/styles.css"/>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MAIN LAYOUT ‚Äî 4 columns
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="app-layout">

  <!-- ‚îÄ‚îÄ COL 1 : Knowledge ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="col col-knowledge">
    <div class="col-header">Knowledge</div>

    <div class="col-list" id="knowledge-list">
      <!-- rendered by JS -->
    </div>

    <div class="col-footer">
      <button class="btn btn-add" id="btn-add-knowledge">Add</button>
      <button class="btn btn-rem" id="btn-remove-knowledge">Remove</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ COL 2 : Source ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="col col-source">
    <div class="col-header">Source</div>

    <div class="col-list" id="source-list">
      <!-- rendered by JS -->
    </div>

    <div class="col-footer">
      <button class="btn btn-add" id="btn-add-source">Add</button>
      <button class="btn btn-rem" id="btn-remove-source">Remove</button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ COL 3 : Mindmap ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="col col-mindmap">
    <div class="col-header">Mindmap</div>

    <div id="graph-container">
      <svg id="graph-svg">
        <defs>
          <marker id="arrow" markerWidth="8" markerHeight="8"
                  refX="8" refY="3" orient="auto">
            <path d="M0,0 L0,6 L8,3 z" fill="#888"/>
          </marker>
        </defs>
        <g id="graph-root"></g>
      </svg>
      <div id="graph-empty" class="graph-empty">
        Ch·ªçn m·ªôt Knowledge ƒë·ªÉ xem Mindmap
      </div>
    </div>

    <div class="col-footer mindmap-footer">
      <button class="btn btn-add"  id="btn-add-node">Add</button>
      <button class="btn btn-rem"  id="btn-remove-node">Remove</button>
      <button class="btn btn-doc"  id="btn-open-document">Document</button>
    </div>
  </div>

  <!-- Vertical drag handle: Mindmap ‚Üî Right panels -->
  <div class="col-resize-handle" id="col-resize-handle"></div>

  <!-- ‚îÄ‚îÄ COL 4 : Right panels ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="col col-right">

    <!-- Document-Node panel -->
    <div class="right-panel" id="panel-document">
      <div class="panel-header">Document ‚Äì Node</div>
      <div class="panel-body" id="document-body">
        <div class="panel-guide">
          <div class="guide-step">
            <div class="guide-num">1</div>
            <div class="guide-text"><strong>Ch·ªçn node</strong> trong Mindmap b·∫±ng c√°ch click v√†o n√≥</div>
          </div>
          <div class="guide-step">
            <div class="guide-num">2</div>
            <div class="guide-text"><strong>Nh·∫•n ‚ÄúDocument‚Äù</strong> ·ªü thanh d∆∞·ªõi Mindmap ‚Äî form s·∫Ω hi·ªán ra ·ªü ƒë√¢y</div>
          </div>
          <div class="guide-step">
            <div class="guide-num">3</div>
            <div class="guide-text"><strong>i·∫øn c√°c tr∆∞·ªùng</strong> ƒë·ªÉ x√¢y d·ª±ng kh·∫ßng x∆∞∆°ng node:</div>
          </div>
          <ul class="guide-field-list">
            <li><strong>Definition</strong> <em>‚Äî ƒê·ªãnh nghƒ©a kh√°i ni·ªám l√† g√¨</em></li>
            <li><strong>Mechanism</strong> <em>‚Äî C∆° ch·∫ø ho·∫°t ƒë·ªông, nguy√™n l√Ω</em></li>
            <li><strong>Boundary</strong> <em>‚Äî Gi·ªõi h·∫°n, ƒëi·ªÅu ki·ªán √°p d·ª•ng</em></li>
            <li><strong>Assumptions</strong> <em>‚Äî C√°c gi·∫£ ƒë·ªãnh n·ªÅn t·∫£ng</em></li>
          </ul>
          <div style="margin-top:8px;font-size:10px;color:#475569">
            ‚ö† Node c·∫ßn c√≥ ƒë·ªß Definition + Mechanism + Boundary m·ªõi c√≥ th·ªÉ chuy·ªÉn sang tr·∫°ng th√°i <strong style="color:#4ade80">ACTIVE</strong>
          </div>
        </div>
      </div>
    </div>

    <!-- Resize handle -->
    <div class="panel-resize-handle" id="panel-resize-handle"></div>

    <!-- Explore-Explain panel -->
    <div class="right-panel" id="panel-explore">
      <div class="panel-header" style="display:flex;align-items:center;justify-content:space-between">
        <span>Explore ‚Äì Explain Node</span>
        <button id="btn-clear-chat" title="Xo√° l·ªãch s·ª≠ chat" onclick="clearChatHistory()" style="background:#1e293b;border:1px solid #334155;color:#f87171;cursor:pointer;font-size:11px;padding:2px 8px;border-radius:10px;line-height:1.6;transition:background .15s" onmouseover="this.style.background='#7f1d1d'" onmouseout="this.style.background='#1e293b'">üóë xo√°</button>
      </div>
      <div class="panel-body">

        <!-- mode selector -->
        <div class="explore-modes" id="explore-modes">
          <label class="mode-btn active" id="mode-clarify-label">
            <input type="radio" name="explore-mode" value="clarify" checked/> Clarify
          </label>
          <label class="mode-btn" id="mode-expand-label">
            <input type="radio" name="explore-mode" value="expand"/> Expand
          </label>
        </div>

        <!-- chat display -->
        <div class="chat-display" id="chat-display"></div>

        <!-- suggested nodes (expand mode) -->
        <div class="suggested-area" id="suggested-area" style="display:none"></div>

        <!-- input row -->
        <div class="chat-input-row">
          <textarea id="chat-input" placeholder="ƒê·∫∑t c√¢u h·ªèi..." rows="1" autocomplete="off"></textarea>
          <button class="btn btn-send" id="btn-send">G·ª≠i ‚ñ∂</button>
        </div>
      </div>
    </div>

  </div><!-- /col-right -->
</div><!-- /app-layout -->


<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê  MODALS  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

<!-- Modal: Add Knowledge -->
<div class="modal-overlay" id="modal-add-knowledge">
  <div class="modal">
    <div class="modal-title">Th√™m Knowledge</div>
    <label>T√™n ch·ªß ƒë·ªÅ
      <input type="text" id="inp-kn-title" placeholder="VD: Kinh t·∫ø h·ªçc"/>
    </label>
    <label>M√¥ t·∫£ (tu·ª≥ ch·ªçn)
      <textarea id="inp-kn-desc" rows="2" placeholder="Ghi ch√∫..."></textarea>
    </label>
    <div class="modal-footer">
      <button class="btn btn-add" id="confirm-add-knowledge">T·∫°o</button>
      <button class="btn btn-rem" onclick="closeModal('modal-add-knowledge')">Hu·ª∑</button>
    </div>
  </div>
</div>

<!-- Modal: Add Source -->
<div class="modal-overlay" id="modal-add-source">
  <div class="modal">
    <div class="modal-title">Th√™m Source</div>
    <label>T√™n hi·ªÉn th·ªã
      <input type="text" id="inp-src-label" placeholder="VD: Kinh t·∫ø ph·∫ßn 1.pdf"/>
    </label>
    <label>Lo·∫°i
      <select id="inp-src-type">
        <option value="PDF">PDF</option>
        <option value="URL">URL</option>
        <option value="TEXT">Text</option>
      </select>
    </label>
    <label>ƒê∆∞·ªùng d·∫´n / URL (tu·ª≥ ch·ªçn)
      <input type="text" id="inp-src-path" placeholder="/path/to/file.pdf ho·∫∑c https://..."/>
    </label>
    <label>Ghi ch√∫
      <textarea id="inp-src-notes" rows="2"></textarea>
    </label>
    <div class="modal-footer">
      <button class="btn btn-add" id="confirm-add-source">Th√™m</button>
      <button class="btn btn-rem" onclick="closeModal('modal-add-source')">Hu·ª∑</button>
    </div>
  </div>
</div>

<!-- Modal: Add Node -->
<div class="modal-overlay" id="modal-add-node">
  <div class="modal">
    <div class="modal-title">Th√™m Node</div>
    <label>Ti√™u ƒë·ªÅ
      <input type="text" id="inp-node-title" placeholder="VD: Kinh t·∫ø vi m√¥"/>
    </label>
    <label>Lo·∫°i node
      <select id="inp-node-type">
        {% for nt in node_types %}
        <option value="{{nt}}">{{nt}}</option>
        {% endfor %}
      </select>
    </label>
    <div class="modal-footer">
      <button class="btn btn-add" id="confirm-add-node">Th√™m</button>
      <button class="btn btn-rem" onclick="closeModal('modal-add-node')">Hu·ª∑</button>
    </div>
  </div>
</div>

<!-- Modal: Add Edge (khi confirm suggested node) -->
<div class="modal-overlay" id="modal-add-edge">
  <div class="modal">
    <div class="modal-title">X√°c nh·∫≠n li√™n k·∫øt</div>
    <p id="edge-desc" class="modal-desc"></p>
    <label>Lo·∫°i quan h·ªá
      <select id="inp-edge-relation">
        {% for rt in relation_types %}
        <option value="{{rt}}">{{rt}}</option>
        {% endfor %}
      </select>
    </label>
    <div class="modal-footer">
      <button class="btn btn-add" id="confirm-add-edge">X√°c nh·∫≠n</button>
      <button class="btn btn-rem" onclick="closeModal('modal-add-edge')">Hu·ª∑</button>
    </div>
  </div>
</div>

<!-- Edge context panel (floating) -->
<div id="edge-ctx" class="edge-ctx">
  <div class="edge-ctx-title">Li√™n k·∫øt</div>
  <select id="edge-ctx-rel"></select>
  <div class="edge-ctx-actions">
    <button class="btn btn-add" onclick="saveEdge()">L∆∞u</button>
    <button class="btn btn-rem" onclick="deleteEdge()">Xo√°</button>
    <button class="btn btn-doc" onclick="closeEdgeCtx()">‚úï</button>
  </div>
</div>

<!-- Toast notification -->
<div class="toast" id="toast"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê  SCRIPTS  ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="/static/app.js?v=12"></script>

</body>
</html>
